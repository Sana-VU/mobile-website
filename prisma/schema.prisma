generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Brand {
  id        Int     @id @default(autoincrement())
  name      String  @unique
  slug      String  @unique
  logo      String?
  phones    Phone[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Phone {
  id          Int     @id @default(autoincrement())
  name        String
  slug        String  @unique
  brandId     Int
  brand       Brand   @relation(fields: [brandId], references: [id])
  ramGB       Int
  storageGB   Int
  fiveG       Boolean
  batteryMAh  Int
  displayInch Float
  releaseYear Int
  chipset     String?
  mainCamera  String?
  frontCamera String?
  os          String?
  ptaApproved Boolean @default(false)
  vendorPrices VendorPrice[]
  priceHistory PriceHistory[]
  comparisonsAsA Comparison[] @relation("ComparisonA")
  comparisonsAsB Comparison[] @relation("ComparisonB")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([brandId])
  @@index([ramGB])
  @@index([fiveG])
}

model Vendor {
  id        Int     @id @default(autoincrement())
  name      String  @unique
  slug      String  @unique
  website   String?
  prices    VendorPrice[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VendorPrice {
  id        Int     @id @default(autoincrement())
  phoneId   Int
  vendorId  Int
  pricePKR  Int
  phone     Phone   @relation(fields: [phoneId], references: [id])
  vendor    Vendor  @relation(fields: [vendorId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([pricePKR])
  @@unique([phoneId, vendorId])
}

model PriceHistory {
  id        Int     @id @default(autoincrement())
  phoneId   Int
  pricePKR  Int
  source    String  // e.g., "Daraz", "PriceOye", "OLX", "WhatMobile"
  phone     Phone   @relation(fields: [phoneId], references: [id])
  date      DateTime @default(now())
  createdAt DateTime @default(now())

  @@index([phoneId, date])
  @@index([pricePKR])
}

model Comparison {
  id        Int     @id @default(autoincrement())
  phoneAId  Int
  phoneBId  Int
  phoneA    Phone   @relation("ComparisonA", fields: [phoneAId], references: [id])
  phoneB    Phone   @relation("ComparisonB", fields: [phoneBId], references: [id])
  createdAt DateTime @default(now())
}
